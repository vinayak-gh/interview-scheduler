<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Schedule Interview - Interview Scheduler</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-cover bg-center"
      style="background-image: url('https://images.unsplash.com/photo-1521791136064-7986c2920216');">
<!-- Overlay -->
<div class="absolute inset-0 bg-black/60"></div>

<div class="relative z-10 max-w-3xl mx-auto px-6 py-10">
    <h1 class="text-4xl font-extrabold text-center mb-2 bg-gradient-to-r from-green-600 via-blue-600 to-purple-600 bg-clip-text text-transparent">
        Schedule an Interview
    </h1>
    <p class="text-center text-gray-200 mb-8">
        Choose a candidate, interviewer, and preferred time. We’ll create the interview in your system.
    </p>

    <div class="bg-white/95 rounded-2xl shadow-2xl p-6">
        <form id="scheduleForm" class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <!-- Candidate -->
            <div class="md:col-span-1">
                <label class="block text-sm font-medium text-gray-700 mb-1">Candidate</label>
                <select id="candidateId" required
                        class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500">
                    <option value="">Select Candidate</option>
                </select>
            </div>

            <!-- Interviewer -->
            <div class="md:col-span-1">
                <label class="block text-sm font-medium text-gray-700 mb-1">Interviewer</label>
                <select id="interviewerId" required
                        class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500">
                    <option value="">Select Interviewer</option>
                </select>
            </div>

            <!-- Date & Time -->
            <div class="md:col-span-1">
                <label class="block text-sm font-medium text-gray-700 mb-1">Date & Time</label>
                <input id="datetime" type="datetime-local" required
                       class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500"/>
            </div>

            <!-- Mode -->
            <div class="md:col-span-1">
                <label class="block text-sm font-medium text-gray-700 mb-1">Mode</label>
                <select id="mode" class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500">
                    <option value="ONLINE">Online</option>
                    <option value="OFFLINE">Offline</option>
                </select>
            </div>

            <!-- Location -->
            <div class="md:col-span-1">
                <label class="block text-sm font-medium text-gray-700 mb-1">Location / Link</label>
                <input id="location" type="text" placeholder="Google Meet / Office Room 3A"
                       class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500"/>
            </div>

            <!-- Notes -->
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                <textarea id="notes" rows="3" placeholder="Add context, round, panel, etc."
                          class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-blue-500"></textarea>
            </div>

            <!-- Submit -->
            <div class="md:col-span-2">
                <button type="submit"
                        class="w-full bg-gradient-to-r from-green-600 via-blue-600 to-purple-600 text-white py-3 rounded-xl hover:opacity-90 transition font-semibold">
                    Create Interview
                </button>
            </div>
        </form>
    </div>

    <!-- Back -->
    <div class="text-center mt-6">
        <a href="dashboard.html" class="text-white/90 hover:underline">← Back to Dashboard</a>
    </div>
</div>

<script>
    const API_BASE = "http://localhost:8080"; // adjust if deployed

    async function loadOptions() {
      try {
        // Load candidates
        const cRes = await fetch(`${API_BASE}/api/candidates`);
        const candidates = cRes.ok ? await cRes.json() : [];
        const cSel = document.getElementById("candidateId");
        cSel.innerHTML += candidates.map(c =>
          `<option value="${c.id}">${c.name} (${c.email})</option>`
        ).join("");

        // Load interviewers
        const iRes = await fetch(`${API_BASE}/api/interviewers`);
        const interviewers = iRes.ok ? await iRes.json() : [];
        const iSel = document.getElementById("interviewerId");
        iSel.innerHTML += interviewers.map(i =>
          `<option value="${i.id}">${i.name} (${i.email})</option>`
        ).join("");
      } catch (e) {
        alert("Failed to load dropdowns: " + e.message);
      }
    }

    document.getElementById("scheduleForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const candidateId = document.getElementById("candidateId").value;
      const interviewerId = document.getElementById("interviewerId").value;
      const dtValue = document.getElementById("datetime").value;
      const mode = document.getElementById("mode").value;
      const location = document.getElementById("location").value.trim();
      const notes = document.getElementById("notes").value.trim();

      if (!dtValue) { alert("Please choose a date & time"); return; }

      const scheduledAt = new Date(dtValue).toISOString();

      // Match InterviewRequestDto fields
      const payload = {
        candidateId: Number(candidateId),
        interviewerId: Number(interviewerId),
        scheduledAt,   // if DTO uses a single datetime
        mode,
        location,
        notes
      };

      try {
        const res = await fetch(`${API_BASE}/api/interviews/schedule`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          alert("✅ Interview scheduled successfully!");
          window.location.href = "interviews.html";
        } else {
          const msg = await res.text();
          alert("❌ Failed to schedule: " + msg);
        }
      } catch (err) {
        alert("Error connecting to backend: " + err.message);
      }
    });

    loadOptions();
</script>
</body>
</html>
